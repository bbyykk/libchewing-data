<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
  <meta content="text/html; charset=UTF-8" http-equiv="content-type">
  <title>新酷音詞庫及注音修改教學</title>
</head>
<body>
新酷音詞庫和注音修改教學 &nbsp;by PCMan &nbsp; 2005.10.20<br>
這份文件是給有興趣修改新酷音詞庫的人。<br>
<br>
準備工作：<br>
<ol>
  <li>你需要取得新酷音詞庫和注音設定的原始資料檔，用來修改後，產生新的詞庫。為了確保你取得的是最新版本的資料，以及方便將自己修改的部份和他
人的修改整合，這個動作必須使用版本控制系統，我們是用Subversion (svn)維護，可用各種 svn 軟體來操作，在 Windows
系統上我們強烈建議使用最簡單的 <a href="http://sourceforge.net/project/showfiles.php?group_id=138498&amp;package_id=151948&amp;release_id=358765">TortoiseSVN</a>。</li>
  <li>如果你希望你做的修正可以內建於新酷音輸入法，被官方納入，請考慮參加「<a href="http://rt.openfoundry.org/Foundry/Project/?Queue=436">新酷音詞庫團隊</a>」，你將可以把你做的修改存入官方版本之中。</li>
  <li>要加入新酷音詞庫團隊請在 <a href="http://rt.openfoundry.org/Foundry/Project/?Queue=436">新酷音詞庫團隊</a> 專案網頁左方連結按下「註冊新帳號」，註冊完成後，將你的帳號寄給 pcman.tw @ gmail.com 並且在信件標題註明 [協助新酷音詞庫] 即可。</li>
</ol>
<br>
安裝好 TortoiseSVN 後，請依照下列步驟操作<br>
<ol>
  <li>找一個你想要的地方，建立名為 libchewing-data 的資料夾</li>
  <li>接下來在資料夾上面按下右鍵，選擇 SVN Checkout</li>
  <li>在接下來出現的畫面中，請在 &nbsp;"URL of repository" 欄位當中輸入：http://svn.openfoundry.org/libchewingdata/ &nbsp;按下 OK 即可</li>
  <li>接下來目錄裡面就會取得所有需要用到的原始檔</li>
</ol>
檔案取得之後，下面是修改的教學：<br>
進入剛剛建立的 libchewing-data 目錄，裡面會有幾個檔案<br>
<ul>
  <li>phone.cin：新酷音的注音都定義在這裡</li>
  <li>tsi.src：詞庫，裡面有所有的詞</li>
  <li>build_data.bat：用來轉格式製作成新酷音真正能用的詞庫檔，執行後會呼叫 dat2bin.exe</li>
</ul>
修改錯誤注音和加詞方式，規則有點複雜，但是按步驟應該不難：<br>
當你發現新酷音有注音錯誤，或是缺少注音的情況，請依下列方式修改<br>
舉例： 原本的新酷音有「呢」這個字，但是打「ㄋㄜ˙」輕聲卻出不來，缺少這個注音，這時候我們要幫他加入，請用文字編輯器開啟 phone.cin 檔 (建議使用 <a href="http://www.notetab.com/download.php">Note Tab Light</a> 或 <a href="http://context.cx/component/option,com_docman/Itemid,48/">ConTEXT</a> 等可以編輯大檔案的編輯器，Windows 的記事本不建議使用，而 PSPad 很強大好用，但搜尋時會誤判中文，可用但是會比較不方便)<br>
phone.cin 的格式很簡單，每一行都是「打出這個字所需的按鍵」+「空一格」+「中文字」<br>
例如「呢」的注音是「ㄋㄜ˙」，對應到鍵盤的英文按鍵是sk7，所以定義這個注音的那一行就應該是<br>
「sk7 呢」，只要加入這行，就可以讓「ㄋㄜ˙」可以打出「呢」。加入 sk7 這行的時候，請用編輯器的「尋找」功能，看一下有無其他同為 sk7
的字，如果沒有，找找看有沒有 sk開頭的或s開頭，盡量跟其他注音一樣或盡量接近的排在一起，按照字母順序排好，方便其他人維護。<br>
<br>
加入這個注音之後，還要修改 tsi.src，這是個有點大的檔案，請用剛剛推薦的文字編輯器開啟。<br>
tsi.src 紀錄了各個字的相關詞，以及各個同音詞和同音字的優先順序，格式解說如下：<br>
tsi.src 每一行都是 「詞」+「空一格」+「詞的優先順序，數字越大越優先」+「空一格」+「詞的注音」<br>
例如「酷音」這個詞，他的定義那行就是：<span style="text-decoration: underline;">酷音 1000 ㄎㄨˋ ㄧㄣ</span> &nbsp; 1000 是這個詞的優先順序，請注意後面的注音在每個字的注音之間也要有空格，像是 「ㄎㄨˋ」「空一格」「 ㄧㄣ」<br>
優先順序的數值是用語料統計來的，不建議手動隨便修改，隨意亂改可能會導致選詞能力變差。<br>
至於一個詞有多種注音時，應該每種注音要是獨立ㄧ行，例如「一個」一詞有「ㄧ ㄍㄜ˙」和「ㄧˊ ㄍㄜ˙」兩種念法，所以在tsi.src 中分別是不同的兩行：「<span style="text-decoration: underline;">一個 65753 ㄧ ㄍㄜ˙</span>」和「<span style="text-decoration: underline;">一個 65753 ㄧˊ ㄍㄜ˙</span>」<br>
大概了解檔案格式後，就開始講要怎麼加詞進去。<br>
剛剛是要加入「呢」這個詞 (字可視為只有一個字的詞)，所以要在原本就有的「呢 17247 ㄋㄜ」後面加入一行「呢 17247 ㄋㄜ˙」，其中 17247 是優先順序，這個數字當然不可能是自己亂填，要考慮很多因素：<br>
<ol>
  <li>用新酷音打這個注音，看看有沒有同音的詞，如果有，請拉出選字視窗，看看有那幾個同音詞。</li>
  <li>看一下這個新加進去的詞，如果要插入到原有的這幾個同音詞之中，依照常用程度，應該要排在第幾順位，如果沒同音詞，請直接跳到步驟 5</li>
  <li>決定出新詞在同音詞之間的插入位置後，用文字編輯器的尋找功能，去找他前面一個和後面一個同音詞，並且查出它們的優先順序數值</li>
  <li>用這兩個數值平均取中間值，就是相加除以2，可以把這個數值當作詞的優先順序數值</li>
  <li>如果這個詞是由好幾個字組成的，去查這幾個字的優先順序數值，請用編輯器的尋找功能找那幾個字，通常詞的優先順序數值應該要比組成他的幾個字
要低，所以取一個比那幾個字都還小的數值就可以了。而如果剛剛你在步驟 2~4 之間訂出一個過高的數值，請把他調低到比這些字都還小就可以了。<span style="font-weight: bold;">請注意這裡有個例外</span>：如果組成這個詞的幾個字當中，有些字幾乎很少單獨用，則這個字可以不用算進來，例如「爸」這個字通常都是用在「爸爸」一詞，很少單獨用，也就是「爸爸」一詞比組成它的「爸」字要常用，這時候不用理會「爸」這個字的優先權，而如果又有同音詞，就直接以步驟 2~4 的同音詞來排序決定即可。</li>
</ol>
摘要：只是單純要加詞，改 tsi.src 加入就可以了，如果只是要更正字的錯誤注音，改 phone.cin 就可以了。如果要新增本來沒有的注音 (破音字)，請改 phone.cin 之後，再到 tsi.src 裡面加入這個字的優先數值和新增的注音拼法<br>
<br>
以上修改完畢後，就可以準備輸出酷音詞庫檔，開始測試<br>
請執行 build_data.bat 這個檔案，執行完畢後會輸出一堆檔案，把下列五個檔案放到
C:\windows\system32\ime\chewing (windows 98/me 是
C:\windows\system\ime\chewing)下覆蓋原檔案就可以了：<br>
dict.dat, &nbsp; ph_index.dat, &nbsp; ch_index.dat, &nbsp; fonetree.dat, &nbsp; us_freq.dat<br>
然後按 Ctrl+Alt+Delete 叫出工作管理員，找到 ChewingServer 這個程序，把他終止掉。<br>
接下來開記事本進行打字測試，看看你剛剛的修改有沒有成功，有沒有造成其他異常<br>
<br>
完成！<br>
如果你是新酷音詞庫團隊的正式成員，可以把你剛剛修改好的部份，上傳到官方網站<br>
請在 libchewing-data 資料夾上按右鍵選擇 「SVN Commit...」，他會問你之前申請的帳號密碼，輸入之後就可以上傳了。
</body>
</html>
